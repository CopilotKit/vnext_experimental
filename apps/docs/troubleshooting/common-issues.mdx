---
title: Common Issues
description: Solutions to common problems when using CopilotKit
icon: "circle-question"
---

## Installation Issues

### Package Not Found

**Problem:** Error installing `@copilotkitnext/*` packages

**Solution:**
1. Ensure you're using the correct package names:
   - `@copilotkitnext/core`
   - `@copilotkitnext/react`
   - `@copilotkitnext/angular`
   - `@copilotkitnext/runtime`

2. Clear your package manager cache:
```bash
# npm
npm cache clean --force

# pnpm
pnpm store prune

# yarn
yarn cache clean
```

3. Delete `node_modules` and reinstall:
```bash
rm -rf node_modules package-lock.json
npm install
```

### TypeScript Errors

**Problem:** TypeScript compilation errors after installation

**Solution:**
1. Ensure you have compatible TypeScript version (4.5+):
```bash
npm install --save-dev typescript@latest
```

2. Update your `tsconfig.json`:
```json
{
  "compilerOptions": {
    "moduleResolution": "node",
    "esModuleInterop": true,
    "skipLibCheck": true
  }
}
```

## Runtime Connection Issues

### Cannot Connect to Runtime

**Problem:** Frontend cannot connect to the runtime endpoint

**Symptoms:**
- "Failed to connect to runtime" error
- Chat component not loading
- No response from agents

**Solutions:**

1. **Verify Runtime URL**
```tsx
// Make sure the URL is correct
<CopilotKitProvider runtimeUrl="http://localhost:3000/api/copilotkit">
```

2. **Check CORS Configuration**
```typescript
// In your runtime setup
app.use(cors({
  origin: 'http://localhost:5173', // Your frontend URL
  credentials: true,
}));
```

3. **Verify Runtime is Running**
```bash
# Check if the runtime server is running
curl http://localhost:3000/api/copilotkit/health
```

4. **Check Network Tab**
Open browser DevTools → Network tab to see the actual error

### WebSocket Connection Failed

**Problem:** WebSocket connection fails or disconnects

**Solutions:**

1. **Check Proxy Configuration** (for Vite/Next.js)
```javascript
// vite.config.js
export default {
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:3000',
        ws: true, // Enable WebSocket proxying
      },
    },
  },
};
```

2. **Verify WebSocket Support**
Ensure your hosting platform supports WebSockets (some serverless platforms don't)

3. **Check Firewall/Network**
Corporate firewalls may block WebSocket connections

## Agent Issues

### Agent Not Responding

**Problem:** Agent doesn't respond to messages

**Solutions:**

1. **Verify Agent Configuration**
```typescript
// Make sure agent is properly configured
export const POST = createCopilotRuntimeHandler({
  agents: {
    assistant: {  // Agent name must match
      model: "gpt-4",
      async *run({ messages, tools }) {
        // Implementation
      },
    },
  },
});
```

2. **Check API Keys**
```bash
# Verify your .env file
OPENAI_API_KEY=sk-...
```

3. **Check Console for Errors**
Look for error messages in both browser and server console

4. **Verify Agent Name**
```tsx
// Agent name in useAgent must match runtime configuration
const agent = useAgent("assistant"); // Must match "assistant" in runtime
```

### Agent Using Wrong Tools

**Problem:** Agent calls incorrect tools or doesn't use available tools

**Solutions:**

1. **Improve Tool Descriptions**
```tsx
useFrontendTool({
  name: "addTodo",
  description: "Add a new todo item to the user's todo list. Use this when the user asks to add, create, or remember a task.",
  // More specific description helps the agent
});
```

2. **Add Parameter Descriptions**
```tsx
parameters: z.object({
  task: z.string().describe("The task description that the user wants to add"),
  priority: z.enum(["low", "medium", "high"]).describe("The priority level of the task"),
})
```

3. **Provide Context**
```tsx
<CopilotKitProvider
  properties={{
    currentPage: "todos",
    availableActions: ["add", "remove", "update"],
  }}
>
```

## Frontend Tool Issues

### Tools Not Being Called

**Problem:** Frontend tools are registered but agent doesn't call them

**Solutions:**

1. **Check Tool Registration**
```tsx
// Make sure tool is registered before chat component renders
useFrontendTool({
  name: "myTool",
  // ...
});
```

2. **Verify Tool is in Scope**
```tsx
// Tool must be registered in a component that's rendered
function MyComponent() {
  useFrontendTool({ /* ... */ });
  return <CopilotChat />; // Chat must be child of component with tool
}
```

3. **Check Tool Name Conflicts**
Ensure no duplicate tool names across frontend and backend

### Tool Handler Not Executing

**Problem:** Tool is called but handler doesn't execute

**Solutions:**

1. **Check for Errors in Handler**
```tsx
handler: async (args) => {
  try {
    // Your logic
    return "Success";
  } catch (error) {
    console.error("Tool error:", error);
    return `Error: ${error.message}`;
  }
}
```

2. **Verify Parameter Schema**
```tsx
// Make sure parameters match what agent sends
parameters: z.object({
  id: z.string(), // Not z.number() if agent sends string
})
```

3. **Return a Value**
```tsx
handler: async (args) => {
  doSomething(args);
  return "Done"; // Always return something
}
```

## React-Specific Issues

### Hooks Not Working

**Problem:** CopilotKit hooks throw errors

**Solutions:**

1. **Ensure Provider is Present**
```tsx
// Hooks must be used inside CopilotKitProvider
<CopilotKitProvider>
  <MyComponent /> {/* Can use hooks here */}
</CopilotKitProvider>
```

2. **Check Hook Rules**
```tsx
// ✅ Good: Hook at component top level
function MyComponent() {
  useFrontendTool({ /* ... */ });
  return <div>...</div>;
}

// ❌ Bad: Hook inside condition
function MyComponent() {
  if (condition) {
    useFrontendTool({ /* ... */ }); // Error!
  }
}
```

### State Not Updating

**Problem:** UI doesn't update when agent changes state

**Solutions:**

1. **Use State Hook Correctly**
```tsx
const { state, setState } = useAgentContext("agent");

// ✅ Good: Update state immutably
setState({ ...state, newValue: 123 });

// ❌ Bad: Mutate state directly
state.newValue = 123; // Won't trigger re-render
```

2. **Check Dependencies**
```tsx
useEffect(() => {
  // React to state changes
}, [state]); // Include state in dependencies
```

## Angular-Specific Issues

### Module Import Errors

**Problem:** Cannot import CopilotKit module

**Solutions:**

1. **Import in App Module**
```typescript
import { CopilotKitModule } from '@copilotkitnext/angular';

@NgModule({
  imports: [
    CopilotKitModule.forRoot({
      runtimeUrl: 'http://localhost:3000/api/copilotkit',
    }),
  ],
})
export class AppModule {}
```

2. **For Standalone Components**
```typescript
import { provideCopilotKit } from '@copilotkitnext/angular';

export const appConfig: ApplicationConfig = {
  providers: [
    provideCopilotKit({
      runtimeUrl: 'http://localhost:3000/api/copilotkit',
    }),
  ],
};
```

### Change Detection Issues

**Problem:** UI doesn't update after agent actions

**Solutions:**

1. **Trigger Change Detection**
```typescript
import { ChangeDetectorRef } from '@angular/core';

constructor(private cdr: ChangeDetectorRef) {}

handler: async (args) => {
  this.data = newData;
  this.cdr.detectChanges(); // Manually trigger
  return "Updated";
}
```

2. **Use NgZone**
```typescript
import { NgZone } from '@angular/core';

constructor(private zone: NgZone) {}

handler: async (args) => {
  this.zone.run(() => {
    this.data = newData; // Run inside Angular zone
  });
  return "Updated";
}
```

## Performance Issues

### Slow Response Times

**Problem:** Agent responses are slow

**Solutions:**

1. **Use Streaming**
```typescript
// Enable streaming in your runtime
async *run({ messages, tools }) {
  const response = await openai.chat.completions.create({
    stream: true, // Enable streaming
    // ...
  });
  
  for await (const chunk of response) {
    yield chunk;
  }
}
```

2. **Optimize Tool Handlers**
```tsx
handler: async (args) => {
  // ✅ Good: Fast operation
  return quickOperation(args);
  
  // ❌ Bad: Slow synchronous operation
  const result = slowSyncOperation(args);
  return result;
}
```

3. **Reduce Context Size**
```tsx
// Don't send unnecessary data
<CopilotKitProvider
  properties={{
    userId: user.id, // ✅ Just the ID
    // user: entireUserObject, // ❌ Too much data
  }}
>
```

### Memory Leaks

**Problem:** Application memory usage grows over time

**Solutions:**

1. **Clean Up Subscriptions**
```tsx
useEffect(() => {
  const subscription = agent.subscribe(/* ... */);
  
  return () => {
    subscription.unsubscribe(); // Clean up
  };
}, []);
```

2. **Memoize Components**
```tsx
const MemoizedComponent = memo(MyComponent);
```

## Getting More Help

If you're still experiencing issues:

<CardGroup cols={2}>
  <Card title="Discord Community" icon="discord" href="https://discord.gg/6dffbvGU3D">
    Get help from the community
  </Card>
  <Card title="GitHub Issues" icon="github" href="https://github.com/copilotkit/copilotkit/issues">
    Report bugs or request features
  </Card>
  <Card title="Debugging Guide" icon="bug" href="/troubleshooting/debugging">
    Learn advanced debugging techniques
  </Card>
  <Card title="Architecture" icon="sitemap" href="/concepts/architecture">
    Understand how CopilotKit works
  </Card>
</CardGroup>


